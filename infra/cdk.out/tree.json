{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.239.0"},"children":{"GomicaleStack":{"id":"GomicaleStack","path":"GomicaleStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.239.0"},"children":{"ProcessorLogGroup":{"id":"ProcessorLogGroup","path":"GomicaleStack/ProcessorLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.239.0"},"children":{"Resource":{"id":"Resource","path":"GomicaleStack/ProcessorLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.239.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":"/aws/lambda/gomicale-processor","retentionInDays":30}}}}},"ProcessorDLQ":{"id":"ProcessorDLQ","path":"GomicaleStack/ProcessorDLQ","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.239.0"},"children":{"Resource":{"id":"Resource","path":"GomicaleStack/ProcessorDLQ/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.239.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"kmsMasterKeyId":"alias/aws/sqs","messageRetentionPeriod":1209600,"queueName":"gomicale-processor-dlq","visibilityTimeout":330}}}}},"ProcessorRole":{"id":"ProcessorRole","path":"GomicaleStack/ProcessorRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.239.0"},"children":{"Resource":{"id":"Resource","path":"GomicaleStack/ProcessorRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.239.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"GomicaleStack/ProcessorRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.239.0"},"children":{"Resource":{"id":"Resource","path":"GomicaleStack/ProcessorRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.239.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ssm:GetParameter","ssm:GetParameters"],"Effect":"Allow","Resource":"arn:aws:ssm:ap-northeast-1:014372010501:parameter/gomicale/*"},{"Action":["sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:SendMessage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["ProcessorDLQ2CA58934","Arn"]}}],"Version":"2012-10-17"},"policyName":"ProcessorRoleDefaultPolicy1C43AEFA","roles":[{"Ref":"ProcessorRoleFC8890DE"}]}}}}}}},"ProcessorFunction":{"id":"ProcessorFunction","path":"GomicaleStack/ProcessorFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.239.0"},"children":{"Code":{"id":"Code","path":"GomicaleStack/ProcessorFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.239.0"},"children":{"Stage":{"id":"Stage","path":"GomicaleStack/ProcessorFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.239.0"}},"AssetBucket":{"id":"AssetBucket","path":"GomicaleStack/ProcessorFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.239.0"}}}},"Resource":{"id":"Resource","path":"GomicaleStack/ProcessorFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.239.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-014372010501-ap-northeast-1","s3Key":"2a54da70722835317bd13b886788d00ddceb368ca521e4a4f1c1a4114c0070cc.zip"},"environment":{"variables":{"NODE_OPTIONS":"--enable-source-maps","PARSER_PROVIDER":"gemini","R2_BUCKET_NAME":"gomicale-pdfs","GEMINI_API_KEY":"","SUPABASE_URL":"","SUPABASE_SERVICE_ROLE_KEY":"","CLOUDFLARE_ACCOUNT_ID":"","R2_ACCESS_KEY_ID":"","R2_SECRET_ACCESS_KEY":"","GOOGLE_CLIENT_ID":"","GOOGLE_CLIENT_SECRET":""}},"functionName":"gomicale-processor","handler":"index.handler","loggingConfig":{"logGroup":{"Ref":"ProcessorLogGroup6E9C0C0D"}},"memorySize":512,"role":{"Fn::GetAtt":["ProcessorRoleFC8890DE","Arn"]},"runtime":"nodejs20.x","timeout":300}}}}},"ProcessorEventInvokeConfig":{"id":"ProcessorEventInvokeConfig","path":"GomicaleStack/ProcessorEventInvokeConfig","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.EventInvokeConfig","version":"2.239.0"},"children":{"Resource":{"id":"Resource","path":"GomicaleStack/ProcessorEventInvokeConfig/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnEventInvokeConfig","version":"2.239.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::EventInvokeConfig","aws:cdk:cloudformation:props":{"destinationConfig":{"onFailure":{"destination":{"Fn::GetAtt":["ProcessorDLQ2CA58934","Arn"]}}},"functionName":{"Ref":"ProcessorFunctionE1AA307D"},"maximumEventAgeInSeconds":3600,"maximumRetryAttempts":1,"qualifier":"$LATEST"}}}}},"LambdaInvokerUser":{"id":"LambdaInvokerUser","path":"GomicaleStack/LambdaInvokerUser","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.User","version":"2.239.0"},"children":{"Resource":{"id":"Resource","path":"GomicaleStack/LambdaInvokerUser/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnUser","version":"2.239.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::User","aws:cdk:cloudformation:props":{"userName":"gomicale-lambda-invoker"}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"GomicaleStack/LambdaInvokerUser/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.239.0"},"children":{"Resource":{"id":"Resource","path":"GomicaleStack/LambdaInvokerUser/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.239.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":{"Fn::GetAtt":["ProcessorFunctionE1AA307D","Arn"]}}],"Version":"2012-10-17"},"policyName":"LambdaInvokerUserDefaultPolicyB4467286","users":[{"Ref":"LambdaInvokerUser7250CA44"}]}}}}}}},"InvokerAccessKey":{"id":"InvokerAccessKey","path":"GomicaleStack/InvokerAccessKey","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnAccessKey","version":"2.239.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::AccessKey","aws:cdk:cloudformation:props":{"userName":{"Ref":"LambdaInvokerUser7250CA44"}}}},"LambdaFunctionArn":{"id":"LambdaFunctionArn","path":"GomicaleStack/LambdaFunctionArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.239.0"}},"InvokerAccessKeyId":{"id":"InvokerAccessKeyId","path":"GomicaleStack/InvokerAccessKeyId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.239.0"}},"InvokerSecretKey":{"id":"InvokerSecretKey","path":"GomicaleStack/InvokerSecretKey","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.239.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"GomicaleStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.5.1"},"children":{"Default":{"id":"Default","path":"GomicaleStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.239.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"GomicaleStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.239.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"GomicaleStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.239.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.5.1"}}}}}